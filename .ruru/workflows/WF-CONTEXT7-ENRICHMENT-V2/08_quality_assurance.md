+++
# --- Step Metadata ---
step_id = "WF-CONTEXT7-ENRICHMENT-V2-08-QUALITY_ASSURANCE" # (String, Required) Unique ID for this step
title = "Step 08: Quality Assurance" # (String, Required) Title of this specific step.
description = """
Initiates the standard ACQA (Automated Checks & Quality Assurance) process for the generated Context7 KB artifacts. The Coordinator (or a delegated QA Agent) performs checks for correctness, validity, consistency, and adherence to standards for the generated files (`kb/context7/`, `_index.json`, `source_info.json`), the summary rule, KB README, usage strategy, and mode definition updates. Issues are handled via correction loops or the AFR process.
"""

# --- Flow Control ---
depends_on = ["WF-CONTEXT7-ENRICHMENT-V2-07-GENERATE_KB_README"] # (Array of Strings, Required) step_ids this step needs completed first.
next_step = "09_user_review.md" # (String, Optional) Filename of the next step on successful completion.
error_step = "EE_handle_error.md" # (String, Optional) Filename to jump to if this step fails.

# --- Execution ---
delegate_to = "roo-commander" # (String, Optional) Coordinator typically runs QA or delegates to QA Agent.

# --- Interface ---
inputs = [ # (Array of Strings, Optional) Data/artifacts needed. Can reference outputs from 'depends_on' steps.
    "Output from step WF-CONTEXT7-ENRICHMENT-V2-00-START: mode_slug",
    "Output from step WF-CONTEXT7-ENRICHMENT-V2-02-EXECUTE_SCRIPT: context7_output_dir", # Path to context7 files
    "Output from step WF-CONTEXT7-ENRICHMENT-V2-03-STORE_SOURCE_INFO: source_info_path",
    "Output from step WF-CONTEXT7-ENRICHMENT-V2-04-GENERATE_SUMMARY_RULE: summary_rule_path",
    "Output from step WF-CONTEXT7-ENRICHMENT-V2-05-UPDATE_KB_USAGE_STRATEGY: usage_strategy_path",
    "Output from step WF-CONTEXT7-ENRICHMENT-V2-07-GENERATE_KB_README: kb_readme_path",
    "Mode definition file path: .ruru/modes/[mode_slug]/[mode_slug].mode.md",
    "Context7 index file path: .ruru/modes/[mode_slug]/kb/context7/_index.json",
]
outputs = [ # (Array of Strings, Optional) Data/artifacts produced by this step.
    "qa_status: Result of the QA process (Pass/Fail/Issues Found).",
    "qa_log: Reference to logs or details of QA findings.",
]

# --- Housekeeping ---
last_updated = "{{DATE}}" # (String, Required) Date of last modification. Use placeholder.
template_schema_doc = ".ruru/templates/toml-md/25_workflow_step_standard.md" # (String, Required) Link to this template definition.
+++

# Step 08: Quality Assurance

## Actions

1.  **Initiate ACQA Process:**
    *   Follow the standard procedure defined in `.ruru/processes/acqa-process.md`.
    *   *(Coordinator or delegated QA Agent performs the checks)*.
2.  **Perform Checks:**
    *   **Context7 Files:** Check for presence and basic structure/format of files within `[context7_output_dir]`.
    *   **Context7 Index:** Validate JSON syntax and basic structure of `kb/context7/_index.json`.
    *   **Source Info:** Validate JSON syntax of `[source_info_path]` and ensure `baseUrl`, `llmsJsonUrl`, and `metadata.tokens` (with a value) are present. Check other metadata fields are present (can be null).
    *   **Summary Rule:** Validate TOML/Markdown syntax of `[summary_rule_path]`. Check `related_context` links and topic list consistency with found `_index.json` files.
    *   **KB README:** Check `[kb_readme_path]` for accuracy, completeness (referencing `context7` and `_index.json`), and formatting.
    *   **Usage Strategy:** Verify `[usage_strategy_path]` exists.
    *   **Mode Definition:** Verify `.ruru/modes/[mode_slug]/[mode_slug].mode.md` correctly includes `kb/context7/_index.json` in `related_context`.
3.  **Handle Issues:**
    *   If issues are found, log them.
    *   Attempt corrections by looping back to relevant previous steps (e.g., re-running script execution, rule generation, file updates).
    *   If corrections fail or issues are severe, initiate the AFR process (`.ruru/processes/afr-process.md`) and potentially proceed to `{{error_step}}`.
4.  **Log QA Result:** Record the outcome (`qa_status`) and reference any findings (`qa_log`).

## Acceptance Criteria

*   The ACQA process has been executed for all relevant artifacts generated by this workflow.
*   All checks passed, or identified issues have been successfully corrected.
*   `qa_status` is "Pass".

## Error Handling

*   If critical issues are found during QA that cannot be easily corrected, log the details, set `qa_status` to "Fail", and proceed to `{{error_step}}`.
+++
# --- Workflow Metadata ---
id = "WF-CONTEXT7-ENRICHMENT-V2" # (String, Required) Unique identifier
title = "Workflow: Context7 KB Enrichment (v2)" # (String, Required)
description = """
Defines the step-by-step procedure for enriching an *existing* specialist mode's KB using AI-processed context derived *specifically* from a Context7 base URL via the `.ruru/scripts/process_llms_json.js` script. This includes fetching source metadata, storing source information (URL, derived `llms.json` URL, and fetched metadata) in `source_info.json`, generating a summary rule file, updating KB/mode artifacts, QA, and user review.
"""
version = "2.0.0" # (String, Required) Semantic version for the workflow definition.
status = "Draft" # (String, Required) Current status: "Draft", "Active", "Deprecated", "Experimental".
tags = [
    "workflow", "kb-enrichment", "context7", "script-integration", "modes", "pipeline",
    "documentation", "sop", "context-handling", "json-context", "subfolders",
    "existing-mode", "url", "summary-rule", "source-info", "metadata", "scraping",
    "mcp-usage", "v2"
] # (Array of Strings, Optional) Keywords for search/categorization.

# --- Execution Control ---
entry_point = "00_start.md" # (String, Required) Filename of the first step to execute.

# --- Interface ---
inputs = [ # (Array of Strings, Optional) Describe overall inputs needed to start the workflow.
    "User request specifying target existing mode slug.",
    "User providing the Context7 base URL.",
    "User confirmation to proceed.",
    "User providing manual metadata if automated fetching fails (optional).",
]
outputs = [ # (Array of Strings, Optional) Describe the expected final artifacts or outcomes.
    "Target mode's KB enriched with Context7 files in `kb/context7/`.",
    "Valid `kb/context7/_index.json` generated by the script.",
    "Valid `kb/context7/source_info.json` containing source URLs and metadata.",
    "Generated summary rule `.roo/rules-[mode_slug]/NN-context7-summary.md`.",
    "Updated mode KB README (`kb/README.md`).",
    "Ensured KB usage strategy document exists (`kb/00-kb-usage-strategy.md`).",
    "Updated mode definition (`.mode.md`) referencing `kb/context7/_index.json`.",
    "Successful QA review log/status.",
    "User confirmation of satisfaction."
]

# --- Housekeeping ---
last_updated = "{{DATE}}" # (String, Required) Date of last modification. Use placeholder.
template_schema_doc = ".ruru/templates/toml-md/23_workflow_readme.md" # (String, Required) Link to this template definition.
related_docs = [
    ".ruru/workflows/WF-CONTEXT7-ENRICHMENT-001.md", # Previous version (single file)
    ".ruru/workflows/WF-MODE-KB-ENRICHMENT-V3/", # General enrichment workflow (directory)
    ".ruru/scripts/process_llms_json.js",
    ".roo/rules/01-standard-toml-md-format.md",
    ".roo/rules/04-mdtm-workflow-initiation.md",
    ".roo/rules/08-logging-procedure-simplified.md",
    ".roo/rules/10-vertex-mcp-usage-guideline.md",
    ".ruru/processes/acqa-process.md",
    ".ruru/processes/afr-process.md",
    ".ruru/processes/pal-process.md",
    ".ruru/docs/planning/enhance_context7_source_info.md"
] # (Array of Strings, Optional) Links to related rules, KBs, ADRs.
+++

# Workflow: Context7 KB Enrichment (v2)

## Overview

Defines the step-by-step procedure for enriching an *existing* specialist mode's KB using AI-processed context derived *specifically* from a Context7 base URL via the `.ruru/scripts/process_llms_json.js` script. This includes fetching source metadata, storing source information (URL, derived `llms.json` URL, and fetched metadata) in `source_info.json`, generating a summary rule file, updating KB/mode artifacts, QA, and user review.

## Usage

This workflow is initiated by Roo Commander or a user to populate an existing mode's KB with structured content processed from a Context7 documentation source. The user provides the target mode and the base URL of the Context7 documentation. The workflow then attempts to fetch metadata, runs a script to process the content, stores source information, generates a summary rule, updates relevant mode files, performs QA, and seeks user approval.

## Inputs

*   **Target Mode Slug:** The slug of the existing mode whose KB will be enriched.
*   **Context7 Base URL:** The base URL of the Context7 documentation source (e.g., `https://context7.com/library/docs`).
*   **User Confirmations:** Confirmation to proceed after initial requirements gathering and final review.
*   **Manual Metadata (Optional):** If automated metadata fetching fails, the user may be prompted to provide the original source URL, token count, snippet count, and last updated date.

## Outputs

*   **Enriched KB:** Files generated by the `process_llms_json.js` script are placed in the `.ruru/modes/[mode_slug]/kb/context7/` directory.
*   **KB Index:** A `_index.json` file within the `kb/context7/` directory, generated by the script.
*   **Source Info:** A `source_info.json` file within the `kb/context7/` directory, containing the base URL, the derived `llms.json` URL, and any fetched/provided metadata (original source URL, tokens, snippets, last updated).
*   **Summary Rule:** A rule file (e.g., `.roo/rules-[mode_slug]/05-context7-summary.md`) summarizing the topics found in the Context7 KB.
*   **Updated KB README:** The mode's main `kb/README.md` is updated to reference the new `context7` directory and its index.
*   **Usage Strategy:** Ensures the `kb/00-kb-usage-strategy.md` file exists.
*   **Updated Mode Definition:** The mode's `.mode.md` file is updated to include `kb/context7/_index.json` in its `related_context`.
*   **QA Status:** Log indicating the result of the Quality Assurance checks.
*   **User Confirmation:** Record of the user's final approval.